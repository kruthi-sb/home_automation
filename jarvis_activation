import speech_recognition as sr
import pyttsx3
import RPi.GPIO as GPIO
import time
##################
#setting up pyttsx3 moudule
engine = pyttsx3.init('sapi5')
voices = engine.getProperty('voices')
engine.setProperty('voice', voices[0].id) #0 stands for male voice
def speak(audio):
    engine.say(audio)
    engine.runAndWait()
###################
###################
#for speech_recognition
def takeCommand():
    r = sr.Recognizer()
     
    with sr.Microphone() as source:
         
        print("Listening...")
        r.pause_threshold = 1
        audio = r.listen(source)
  
    try:
        print("Recognizing...")   
        query = r.recognize_google(audio, language ='en-in')
        print("you said -->", query)
  
    except Exception as e:
        print(e)   
        print("Unable to Recognize your voice.") 
        return "None"
    
    return query
######################
living_room = 38 #stonewolf
study_room = 36 #werewolf 
kitchen = 32 #pumpkin
all_lights = [38, 36, 32] #monstermash
GPIO.setmode(GPIO.BOARD)
relay = all_lights
for x in relay:
    GPIO.setup(x, GPIO.OUT)

'''@app.route("/")
def index():
    return render_template('index.html')
@app.route("/<deviceName>/")'''

def action(deviceName):
    speak("hi,this is Jarvis")
    speak("how can I help?")
    query = takeCommand()
    query = query.lower()
    if "on" in query:
        if 'living room' in query:
            speak("OK, turning on living room light")
            num  = 38
            GPIO.setmode(GPIO.BOARD)
            GPIO.setup(num, GPIO.OUT)
            GPIO.output(num, GPIO.LOW)
        if 'study room' in query:
            speak("OK, turning on study room light")
            num  = 36
            GPIO.setmode(GPIO.BOARD)
            GPIO.setup(num, GPIO.OUT)
            GPIO.output(num, GPIO.LOW)
        if 'kitchen' in query:
            speak("OK, turning on kitchen light")
            num  = 32
            GPIO.setmode(GPIO.BOARD)
            GPIO.setup(num, GPIO.OUT)
            GPIO.output(num, GPIO.LOW)
        if 'all lights' in query or "all light" in query:
            speak("OK, turning on all lights")
            relay = [38, 36, 32]
            for x in relay:
                GPIO.setmode(GPIO.BOARD)
                GPIO.setup(x, GPIO.OUT)
                GPIO.output(x, GPIO.LOW)
        
        
    if "off" in query:
        if 'living room' in query:
            speak("OK, turning off living room light")
            num = 38
            GPIO.output(num, GPIO.HIGH)
        if 'study room' in query:
            speak("OK, turning off study room light")
            num = 36
            GPIO.output(num, GPIO.HIGH)
        if 'kitchen' in query:
            speak("OK, turning off kitchen light")
            num = 32
            GPIO.output(num, GPIO.HIGH)
        if 'all lights' in query or "all light" in query:
            speak("OK, turning off all lights")
            relay = [38, 36, 32]
            for x in relay:
                GPIO.output(x, GPIO.HIGH)
